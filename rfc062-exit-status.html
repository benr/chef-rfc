<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable = no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation-essential/6.2.2/css/foundation.min.css">
    <style>
      a { color: #f18b21; }
      a:hover, a:focus { color: #3f5364; }
    </style>
    <title>Chef RFCs</title>
  </head>
  <body>
    <div class="row medium-12 columns">
      <header class="clearfix">
        <div class="left">
          <a href="/chef-rfc"><h1>Chef RFCs</h1></a>
        </div>
      </header>
<h1>Chef-Client Exit Codes</h1>

<p>Signal outside tools of specific Chef-Client run status.  Ability to determine results of a Chef-Client run.</p>

<h2>Motivation</h2>
<div class="highlight"><pre><span></span>As a Chef user,
I want to be able to determine when a chef-client run is rebooting the node,
so that Test-Kitchen/Vagrant/any outside tool can wait for node to reboot, and continue converging.
</pre></div>
<h2>Specification</h2>

<ul>
<li>Chef applications (e.g. chef-client) that interpret recipes should use the specified exit codes</li>
<li>Chef tools (e.g. knife) should behave appropriately for the exit code, or pass it to the user</li>
</ul>

<h3>Exit codes Reserved by Operating System</h3>

<ul>
<li>Windows- <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms681381(v=vs.85).aspx">Link</a></li>
<li>Linux - <a href="http://www.freebsd.org/cgi/man.cgi?query=sysexits&apropos=0&sektion=0&manpath=FreeBSD+4.3-RELEASE&format=html">Sysexits</a>, <a href="http://tldp.org/LDP/abs/html/exitcodes.html">Bash Scripting</a></li>
</ul>

<h3>Remaining Available Exit Codes</h3>

<p>All exit codes defined should be usable on all supported Chef Platforms.  Also the exit codes used should be identical across platforms.  That limits the total range from 1-255.  Exit codes not explicitly used by Linux/Windows are listed below.  There are 59 exit codes that are available on both platforms.
 * Any numbers below that have a strike-through are used below in the <strong>Exit Codes in Use</strong> section
 * Exit Codes Available for Chef use :
     * ~~35,37,40,41,42~~,43,44,45,46,47,48,49,79,81,90,91,92,93,94,95,96,97
     * 98,99,115,116,168,169,172,175,176,177,178,179,181,184,185,204,211
     * ~~213~~,219,227,228,235,236,237,238,239,241,242,243,244,245</p>

<h3>Precedence</h3>

<ul>
<li>Reboot exit codes should take precedence over Chef Execution State</li>
<li>Precedence within a table should be evaluated from the top down.

<ul>
<li> Example - Audit Mode Failure would only apply on a successful execution.  But if the chef-run failed for any other reason, no reason to exit with audit mode.</li>
</ul></li>
</ul>

<h2>Exit Codes in Use</h2>

<h4>Reboot Requirement</h4>

<p>Exit Code        | Reason            | Details
-------------    | -------------     |-----
35               | Reboot Scheduled  | Reboot has been scheduled in the run state
37               | Reboot Needed     | Reboot needs to be completed
41               | Reboot Failed     | Initiated Reboot failed - due to permissions or any other reason</p>

<h4>Chef Run State</h4>

<p>Exit Code        | Reason             | Details
-------------    | -------------      |-----
-1               | Failed execution*   | Generic error during Chef execution.  On Linux this will show up as 255, on Windows as -1
0                | Successful run     | Any successful execution of a Chef utility should return this exit code
1                | Failed execution   | Generic error during Chef execution.
2                | SIGINT received    | Received an interrupt signal
3                | SIGTERM received   | Received an terminate signal
42               | Audit Mode Failure | Audit mode failed, but chef converged successfully.
213              | Chef upgrade       | Chef has exited during a client upgrade</p>

<ul>
<li>*Next release should deprecate any use of this exit code.</li>
</ul>

<h2>Extend</h2>

<p>This RFC should be able to be amended to include additional exit code functionality at a later date.  Additional exit codes are assigned by pull request against this RFC as detailed in <a href="https://github.com/chef/chef-rfc/blob/master/rfc000-rfc-process.md#changing-an-accepted-rfc">RFC000</a></p>

<h2>Copyright</h2>

<p>This work is in the public domain. In jurisdictions that do not allow for this,
this work is available under CC0. To the extent possible under law, the person
who associated CC0 with this work has waived all copyright and related or
neighboring rights to this work.</p>
    </div>
  </body>
</html>
